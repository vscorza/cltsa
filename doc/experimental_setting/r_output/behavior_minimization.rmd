---
title: "Behavior Minimization"
author: "Mariano Cerrutti"
date: "5/26/2020"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      results= "hide")
#install.packages("dplyr")
#install.packages("magrittr")
#install.packages("ggplot2")
#install.packages("jsonlite")
library(dplyr)
library(magrittr)
library(ggplot2)
library(jsonlite)
library(gridExtra)
library(grid)
library(lattice)
experimental_composite <- read.csv(file='/home/mariano/code/henos-automata/doc/experimental_setting/tmp_results/general_data_composite.csv')
genbuf_missing <- subset(experimental_composite, grepl("automaton_missing_assumption", name, fixed=TRUE))
genbuf_removed <- subset(experimental_composite, grepl("automaton_removed_env_safety", name, fixed=TRUE))
collector_missing <- subset(experimental_composite, grepl("v1_missing_assumption", name, fixed=TRUE))
robot_samples <- subset(experimental_composite, grepl("robot", name, fixed=TRUE))

```

#Selected Graphs

## Minimization and controllability
```{r echo=FALSE}
#sive vs diagnosis time
ggplot(experimental_composite, aes(x=plant_transitions, y=diagnosis_time)) +
	labs(title="Size vs diagnosis time") +
	xlab(expression(paste("|",Delta["E"],"|"))) +
	ylab("Diagnosis time (s)") +
	scale_y_log10() +
	scale_x_log10() +	
	geom_point(color='red') +	
	geom_smooth(method='lm')
```

## Minimization and minimization controllability

```{r echo=FALSE}
#plant controllability vs minimization amount
c_coeff = experimental_composite$minimization_controllable_transitions / experimental_composite$plant_transitions	
m_coeff = experimental_composite$minimization_transitions / experimental_composite$plant_transitions	
ggplot(experimental_composite, aes(x=c_coeff, y=m_coeff)) +
	labs(title="Minimization controllability vs minimization amount") +
	xlab("Minimization controllability") +
	ylab("Reduction") +
	scale_y_log10() +
	scale_x_log10() +	
	geom_point(color='red') +
	geom_smooth(method='lm')	
```

# Compared graphs

```{r echo=FALSE}
#rows, cols
sizediag_g_ass <- ggplot(genbuf_missing, aes(x=plant_transitions, y=diagnosis_time)) +
	labs(title="Genbuf.ass.") +
	xlab(expression(paste("|",Delta["E"],"|"))) +
	ylab("Diagnosis time (s)") +
	scale_y_log10() +
	scale_x_log10() +	
	geom_point(color='red') +	
	geom_smooth(method='lm')
sizediag_safety <- ggplot(genbuf_removed, aes(x=plant_transitions, y=diagnosis_time)) +
	labs(title="Genbuf.safety") +
	xlab(expression(paste("|",Delta["E"],"|"))) +
	ylab("Diagnosis time (s)") +
	scale_y_log10() +
	scale_x_log10() +	
	geom_point(color='red') +	
	geom_smooth(method='lm')
sizediag_collector <- ggplot(collector_missing, aes(x=plant_transitions, y=diagnosis_time)) +
	labs(title="Collector") +
	xlab(expression(paste("|",Delta["E"],"|"))) +
	ylab("Diagnosis time (s)") +
	scale_y_log10() +
	scale_x_log10() +	
	geom_point(color='red') +	
	geom_smooth(method='lm')	
sizediag_exploration <- ggplot(robot_samples, aes(x=plant_transitions, y=diagnosis_time)) +
	labs(title="Robot") +
	xlab(expression(paste("|",Delta["E"],"|"))) +
	ylab("Diagnosis time (s)") +
	scale_y_log10() +
	scale_x_log10() +	
	geom_point(color='red') +	
	geom_smooth(method='lm')
plantminsize_g_ass <- ggplot(genbuf_missing, aes(x=plant_transitions, y=minimization_transitions)) +
	labs(title="Genbuf.ass.") +
	xlab(expression(paste("|",Delta[E],"|"))) +
	ylab(expression(paste("|",Delta[paste("E","'")],"|"))) +
	scale_y_log10() +
	scale_x_log10() +	
	geom_point(color='red') +	
	geom_smooth(method='lm')	
plantminsize_safety <- ggplot(genbuf_removed, aes(x=plant_transitions, y=minimization_transitions)) +
	labs(title="Genbuf.safety") +
	xlab(expression(paste("|",Delta[E],"|"))) +
	ylab(expression(paste("|",Delta[paste("E","'")],"|"))) +
	scale_y_log10() +
	scale_x_log10() +	
	geom_point(color='red') +	
	geom_smooth(method='lm')		
plantminsize_collector <- ggplot(collector_missing, aes(x=plant_transitions, y=minimization_transitions)) +
	labs(title="Collector") +
	xlab(expression(paste("|",Delta[E],"|"))) +
	ylab(expression(paste("|",Delta[paste("E","'")],"|"))) +
	scale_y_log10() +
	scale_x_log10() +	
	geom_point(color='red') 
#+	geom_smooth(method='lm')	
plantminsize_exploration <- ggplot(robot_samples, aes(x=plant_transitions, y=minimization_transitions)) +
	labs(title="Robot") +
	xlab(expression(paste("|",Delta[E],"|"))) +
	ylab(expression(paste("|",Delta[paste("E","'")],"|"))) +
	scale_y_log10() +
	scale_x_log10() +	
	geom_point(color='red') +	
	geom_smooth(method='lm')	
c_coeff_ga = genbuf_missing$plant_controllable_transitions / genbuf_missing$plant_transitions	
m_coeff_ga = genbuf_missing$minimization_transitions / genbuf_missing$plant_transitions	
control_g_ass <- ggplot(genbuf_missing, aes(x=c_coeff_ga, y=m_coeff_ga)) +
	labs(title="Genbuf.ass") +
	xlab("Controllability") +
	ylab("Reduction") +
	scale_y_log10() +
	scale_x_log10() +	
	geom_point(color='red') +
	geom_smooth(method='lm')	
c_coeff_gs = genbuf_removed$plant_controllable_transitions / genbuf_removed$plant_transitions	
m_coeff_gs = genbuf_removed$minimization_transitions / genbuf_removed$plant_transitions	
control_safety <- ggplot(genbuf_removed, aes(x=c_coeff_gs, y=m_coeff_gs)) +
	labs(title="Genbuf.safety") +
	xlab("Controllability") +
	ylab("Reduction") +
	scale_y_log10() +
	scale_x_log10() +	
	geom_point(color='red') +
	geom_smooth(method='lm')
c_coeff_c = collector_missing$plant_controllable_transitions / collector_missing$plant_transitions	
m_coeff_c = collector_missing$minimization_transitions / collector_missing$plant_transitions	
control_collector <- ggplot(collector_missing, aes(x=c_coeff_c, y=m_coeff_c)) +
	labs(title="Collector") +
	xlab("Controllability") +
	ylab("Reduction") +
	scale_y_log10() +
	scale_x_log10() +	
	geom_point(color='red') 
# +	geom_smooth(method='lm')
c_coeff_r = robot_samples$plant_controllable_transitions / robot_samples$plant_transitions	
m_coeff_r = robot_samples$minimization_transitions / robot_samples$plant_transitions	
control_robot <- ggplot(robot_samples, aes(x=c_coeff_r, y=m_coeff_r)) +
	labs(title="Robot") +
	xlab("Controllability") +
	ylab("Reduction") +
	scale_y_log10() +
	scale_x_log10() +	
	geom_point(color='red') +
	geom_smooth(method='lm')	
```

```{r echo=FALSE}
grid.arrange(sizediag_g_ass, sizediag_safety, sizediag_collector, sizediag_exploration, plantminsize_g_ass, plantminsize_safety, plantminsize_collector, plantminsize_exploration, control_g_ass, control_safety, control_collector, control_robot, ncol=4)
```


# Composite graphs

## Minimization distribution

```{r echo=FALSE}
experimental_composite$m_coeff = experimental_composite$minimization_transitions / experimental_composite$plant_transitions
experimental_composite$relative_time = experimental_composite$diagnosis_time / experimental_composite$plant_transitions
experimental_composite$relative_time_liveness = experimental_composite$diagnosis_time / (experimental_composite$plant_transitions + experimental_composite$assumptions_count + experimental_composite$guarantees_count)
ggplot(experimental_composite, aes(x=m_coeff)) + 
  labs(title="Minimization distribution", subtitle="Overall") +
  xlab("Minimization rate") +
  ylab("Count") + 
    geom_histogram(color="black",fill="white")
ggplot(experimental_composite, aes(x=relative_time)) + 
  labs(title=expression(paste("Min. time / |",Delta["E"],"|")), subtitle="Overall") +
  xlab("Minimization rate") +
  ylab("Count") + 
    geom_histogram(color="black",fill="white")
ggplot(experimental_composite, aes(x=relative_time_liveness)) + 
  labs(title=expression(paste("Min. time / (|",Delta["E"],"|* liveness)")), subtitle="Overall") +
  xlab("Minimization rate") +
  ylab("Count") + 
    geom_histogram(color="black",fill="white")
genbuf_missing$m_coeff = genbuf_missing$minimization_transitions / genbuf_missing$plant_transitions
genbuf_missing$relative_time = genbuf_missing$diagnosis_time / genbuf_missing$plant_transitions
genbuf_missing$relative_time_liveness = genbuf_missing$diagnosis_time / (genbuf_missing$plant_transitions + genbuf_missing$assumptions_count + genbuf_missing$guarantees_count)
hist_g_ass <- ggplot(genbuf_missing, aes(x=m_coeff)) + 
  labs(title="Minimization distribution", subtitle="Genbuf miss. ass.") +
  xlab("Minimization rate") +
  ylab("Count") + 
    geom_histogram(color="black",fill="white")
hist_g_ass_rel <- ggplot(genbuf_missing, aes(x=relative_time)) + 
  labs(title=expression(paste("Min. time / |",Delta["E"],"|")), subtitle="Genbuf miss. ass.") +
  xlab("Minimization rate") +
  ylab("Count") + 
    geom_histogram(color="black",fill="white")
hist_g_ass_rel_liv <- ggplot(genbuf_missing, aes(x=relative_time_liveness)) + 
  labs(title=expression(paste("Min. time / (|",Delta["E"],"|* liveness)")), subtitle="Genbuf miss. ass.") +
  xlab("Minimization rate") +
  ylab("Count") + 
    geom_histogram(color="black",fill="white")
genbuf_removed$m_coeff = genbuf_removed$minimization_transitions / genbuf_removed$plant_transitions
genbuf_removed$relative_time = genbuf_removed$diagnosis_time / genbuf_removed$plant_transitions
genbuf_removed$relative_time_liveness = genbuf_removed$diagnosis_time / (genbuf_removed$plant_transitions + genbuf_removed$assumptions_count + genbuf_removed$guarantees_count)
hist_g_safety <- ggplot(genbuf_removed, aes(x=m_coeff)) + 
  labs(title="Minimization distribution", subtitle="Genbuf removed env. safety") +
  xlab("Minimization rate") +
  ylab("Count") + 
    geom_histogram(color="black",fill="white")
hist_g_safety_rel <- ggplot(genbuf_removed, aes(x=relative_time)) + 
  labs(title=expression(paste("Min. time / |",Delta["E"],"|")), subtitle="Genbuf removed env. safety") +
  xlab("Minimization rate") +
  ylab("Count") + 
    geom_histogram(color="black",fill="white")
hist_g_safety_rel_liv<- ggplot(genbuf_removed, aes(x=relative_time_liveness)) + 
  labs(title=expression(paste("Min. time / (|",Delta["E"],"|* liveness)")), subtitle="Genbuf removed env. safety") +
  xlab("Minimization rate") +
  ylab("Count") + 
    geom_histogram(color="black",fill="white")
collector_missing$m_coeff = collector_missing$minimization_transitions / collector_missing$plant_transitions
collector_missing$relative_time = collector_missing$diagnosis_time / collector_missing$plant_transitions
collector_missing$relative_time_liveness = collector_missing$diagnosis_time / (collector_missing$plant_transitions + collector_missing$assumptions_count + collector_missing$guarantees_count)
hist_collector <- ggplot(collector_missing, aes(x=m_coeff)) + 
  labs(title="Minimization distribution", subtitle="Collector") +
  xlab("Minimization rate") +
  ylab("Count") + 
    geom_histogram(color="black",fill="white")
hist_collector_rel <- ggplot(collector_missing, aes(x=relative_time)) + 
  labs(title=expression(paste("Min. time / |",Delta["E"],"|")), subtitle="Collector") +
  xlab("Minimization rate") +
  ylab("Count") + 
    geom_histogram(color="black",fill="white")
hist_collector_rel_liv <- ggplot(collector_missing, aes(x=relative_time_liveness)) + 
  labs(title=expression(paste("Min. time / (|",Delta["E"],"|* liveness)")), subtitle="Collector") +
  xlab("Minimization rate") +
  ylab("Count") + 
    geom_histogram(color="black",fill="white")
robot_samples$m_coeff = robot_samples$minimization_transitions / robot_samples$plant_transitions
robot_samples$relative_time = robot_samples$diagnosis_time / robot_samples$plant_transitions
robot_samples$relative_time_liveness = robot_samples$diagnosis_time / (robot_samples$plant_transitions + robot_samples$assumptions_count + robot_samples$guarantees_count)
hist_robot <- ggplot(robot_samples, aes(x=m_coeff)) + 
  labs(title="Minimization distribution", subtitle="Robot Explorer") +
  xlab("Minimization rate") +
  ylab("Count") + 
    geom_histogram(color="black",fill="white")
hist_robot_rel <- ggplot(robot_samples, aes(x=relative_time)) + 
  labs(title=expression(paste("Min. time / |",Delta["E"],"|")), subtitle="Robot Explorer") +
  xlab("Minimization rate") +
  ylab("Count") + 
    geom_histogram(color="black",fill="white")
hist_robot_rel_liv <- ggplot(robot_samples, aes(x=relative_time_liveness)) + 
  labs(title=expression(paste("Min. time / (|",Delta["E"],"|* liveness)")), subtitle="Robot Explorer") +
  xlab("Minimization rate") +
  ylab("Count") + 
    geom_histogram(color="black",fill="white")

grid.arrange(hist_g_ass, hist_g_safety, hist_collector, hist_robot, ncol=2)

grid.arrange(hist_g_ass_rel, hist_g_safety_rel, hist_collector_rel, hist_robot_rel, ncol=2)

grid.arrange(hist_g_ass_rel_liv, hist_g_safety_rel_liv, hist_collector_rel_liv, hist_robot_rel_liv, ncol=2)
```

## Minimization and controllability
```{r echo=FALSE}
#sive vs diagnosis time
ggplot(experimental_composite, aes(x=plant_transitions, y=diagnosis_time)) +
	labs(title="Size vs diagnosis time") +
	xlab(expression(paste("|",Delta["E"],"|"))) +
	ylab("Diagnosis time (s)") +
	scale_y_log10() +
	scale_x_log10() +	
	geom_point(color='red') +	
	geom_smooth(method='lm')
```
## Minimization and controllability
```{r echo=FALSE}
#plant size vs minimization time	
ggplot(experimental_composite, aes(x=plant_transitions, y=minimization_transitions)) +
	labs(title="Plant size vs minimization size") +
	xlab(expression(paste("|",Delta[E],"|"))) +
	ylab(expression(paste("|",Delta[paste("E","'")],"|"))) +
	scale_y_log10() +
	scale_x_log10() +	
	geom_point(color='red') 
```

```{r echo=FALSE}
#plant size vs minimization time w labels
hidden <- ggplot(experimental_composite, aes(x=plant_transitions, y=minimization_transitions, label=name)) +
	labs(title="Plant size vs minimization size") +
	xlab(expression(paste("|",Delta[E],"|"))) +
	ylab(expression(paste("|",Delta[paste("E","'")],"|"))) +
	scale_y_log10() +
	scale_x_log10() +	
	geom_point(color='red') +	
	geom_text(aes(label=as.character(name)),hjust=0,vjust=0) +
	geom_smooth(method='lm')
```
## Minimization and plant controllability
```{r echo=FALSE}
#plant controllability vs minimization amount
c_coeff = experimental_composite$plant_controllable_transitions / experimental_composite$plant_transitions	
m_coeff = experimental_composite$minimization_transitions / experimental_composite$plant_transitions	
ggplot(experimental_composite, aes(x=c_coeff, y=m_coeff)) +
	labs(title="Plant controllability vs minimization amount") +
	xlab("Plant controllability") +
	ylab("Reduction") +
	scale_y_log10() +
	scale_x_log10() +	
	geom_point(color='red') 
```

```{r echo=FALSE}
#plant controllability vs minimization amount w labels
c_coeff = experimental_composite$plant_controllable_transitions / experimental_composite$plant_transitions	
m_coeff = experimental_composite$minimization_transitions / experimental_composite$plant_transitions	
hidden <- ggplot(experimental_composite, aes(x=c_coeff, y=m_coeff, label=name)) +
	labs(title="Plant controllability vs minimization amount") +
	xlab("Controllability") +
	ylab("Reduction") +
	scale_y_log10() +
	scale_x_log10() +	
	geom_point(color='red') +
	geom_text(aes(label=as.character(name)),hjust=0,vjust=0) +
	geom_smooth(method='lm')	
    
```

## Minimization and minimization controllability

```{r echo=FALSE}
#plant controllability vs minimization amount
c_coeff = experimental_composite$minimization_controllable_transitions / experimental_composite$plant_transitions	
m_coeff = experimental_composite$minimization_transitions / experimental_composite$plant_transitions	
ggplot(experimental_composite, aes(x=c_coeff, y=m_coeff)) +
	labs(title="Minimization controllability vs minimization amount") +
	xlab("Minimization controllability") +
	ylab("Reduction") +
	scale_y_log10() +
	scale_x_log10() +	
	geom_point(color='red') +
	geom_smooth(method='lm')	
```


# Genbuf missing assumption

## Minimization and controllability

```{r echo=FALSE}
#sive vs diagnosis time
ggplot(genbuf_missing, aes(x=plant_transitions, y=diagnosis_time)) +
	labs(title="Size vs diagnosis time") +
	xlab(expression(paste("|",Delta["E"],"|"))) +
	ylab("Diagnosis time (s)") +
	scale_y_log10() +
	scale_x_log10() +	
	geom_point(color='red') +	
	geom_smooth(method='lm')
```

## Plant vs minimization time

```{r echo=FALSE}
#plant size vs minimization time	
ggplot(genbuf_missing, aes(x=plant_transitions, y=minimization_transitions)) +
	labs(title="Plant size vs minimization size") +
	xlab(expression(paste("|",Delta[E],"|"))) +
	ylab(expression(paste("|",Delta[paste("E","'")],"|"))) +
	scale_y_log10() +
	scale_x_log10() +	
	geom_point(color='red') +	
	geom_smooth(method='lm')
```

## Plant controllability vs minimization rate

```{r echo=FALSE}
#plant controllability vs minimization amount
c_coeff = genbuf_missing$plant_controllable_transitions / genbuf_missing$plant_transitions	
m_coeff = genbuf_missing$minimization_transitions / genbuf_missing$plant_transitions	
ggplot(genbuf_missing, aes(x=c_coeff, y=m_coeff)) +
	labs(title="Plant controllability vs minimization amount") +
	xlab("Controllability") +
	ylab("Reduction") +
	scale_y_log10() +
	scale_x_log10() +	
	geom_point(color='red') +
	geom_smooth(method='lm')	
```

# Genbuf removed env. safety

## Minimization and controllability

```{r echo=FALSE}
#sive vs diagnosis time
ggplot(genbuf_removed, aes(x=plant_transitions, y=diagnosis_time)) +
	labs(title="Size vs diagnosis time") +
	xlab(expression(paste("|",Delta["E"],"|"))) +
	ylab("Diagnosis time (s)") +
	scale_y_log10() +
	scale_x_log10() +	
	geom_point(color='red') +	
	geom_smooth(method='lm')
```

## Plant vs minimization time

```{r echo=FALSE}
#plant size vs minimization time	
ggplot(genbuf_removed, aes(x=plant_transitions, y=minimization_transitions)) +
	labs(title="Plant size vs minimization size") +
	xlab(expression(paste("|",Delta[E],"|"))) +
	ylab(expression(paste("|",Delta[paste("E","'")],"|"))) +
	scale_y_log10() +
	scale_x_log10() +	
	geom_point(color='red') +	
	geom_smooth(method='lm')
```

## Plant controllability vs minimization rate

```{r echo=FALSE}
#plant controllability vs minimization amount
c_coeff = genbuf_removed$plant_controllable_transitions / genbuf_removed$plant_transitions	
m_coeff = genbuf_removed$minimization_transitions / genbuf_removed$plant_transitions	
ggplot(genbuf_removed, aes(x=c_coeff, y=m_coeff)) +
	labs(title="Plant controllability vs minimization amount") +
	xlab("Controllability") +
	ylab("Reduction") +
	scale_y_log10() +
	scale_x_log10() +	
	geom_point(color='red') +
	geom_smooth(method='lm')	
```


# Collector missing assumption

## Minimization and controllability

```{r echo=FALSE}
#sive vs diagnosis time
ggplot(collector_missing, aes(x=plant_transitions, y=diagnosis_time)) +
	labs(title="Size vs diagnosis time") +
	xlab(expression(paste("|",Delta["E"],"|"))) +
	ylab("Diagnosis time (s)") +
	scale_y_log10() +
	scale_x_log10() +	
	geom_point(color='red') +	
	geom_smooth(method='lm')
```

## Plant vs minimization time

```{r echo=FALSE}
#plant size vs minimization time	
ggplot(collector_missing, aes(x=plant_transitions, y=minimization_transitions)) +
	labs(title="Plant size vs minimization size") +
	xlab(expression(paste("|",Delta[E],"|"))) +
	ylab(expression(paste("|",Delta[paste("E","'")],"|"))) +
	scale_y_log10() +
	scale_x_log10() +	
	geom_point(color='red') +	
	geom_smooth(method='lm')
```

## Plant controllability vs minimization rate

```{r echo=FALSE}
#plant controllability vs minimization amount
c_coeff = collector_missing$plant_controllable_transitions / collector_missing$plant_transitions	
m_coeff = collector_missing$minimization_transitions / collector_missing$plant_transitions	
ggplot(collector_missing, aes(x=c_coeff, y=m_coeff)) +
	labs(title="Plant controllability vs minimization amount") +
	xlab("Controllability") +
	ylab("Reduction") +
	scale_y_log10() +
	scale_x_log10() +	
	geom_point(color='red') +
	geom_smooth(method='lm')	
```

# Exploration robot missing assumption

## Minimization and controllability

```{r echo=FALSE}
#sive vs diagnosis time
ggplot(robot_samples, aes(x=plant_transitions, y=diagnosis_time)) +
	labs(title="Size vs diagnosis time") +
	xlab(expression(paste("|",Delta["E"],"|"))) +
	ylab("Diagnosis time (s)") +
	scale_y_log10() +
	scale_x_log10() +	
	geom_point(color='red') +	
	geom_smooth(method='lm')
```

## Plant vs minimization time

```{r echo=FALSE}
#plant size vs minimization time	
ggplot(robot_samples, aes(x=plant_transitions, y=minimization_transitions)) +
	labs(title="Plant size vs minimization size") +
	xlab(expression(paste("|",Delta[E],"|"))) +
	ylab(expression(paste("|",Delta[paste("E","'")],"|"))) +
	scale_y_log10() +
	scale_x_log10() +	
	geom_point(color='red') +	
	geom_smooth(method='lm')
```

## Plant controllability vs minimization rate

```{r echo=FALSE}
#plant controllability vs minimization amount
c_coeff = robot_samples$plant_controllable_transitions / robot_samples$plant_transitions	
m_coeff = robot_samples$minimization_transitions / robot_samples$plant_transitions	
ggplot(robot_samples, aes(x=c_coeff, y=m_coeff)) +
	labs(title="Plant controllability vs minimization amount") +
	xlab("Controllability") +
	ylab("Reduction") +
	scale_y_log10() +
	scale_x_log10() +	
	geom_point(color='red') +
	geom_smooth(method='lm')	
```
