//GenBuf example taken from Synthesis of Reactive(1) Designs 2 senders
set Global_Alphabet = {n,s,e,w,load,unload,drop,correct,bCast}
set Controllable_Alphabet = {n,s,e,w}

set Global_Signals	= {Dummy}
order 				= {}
const Min = 1 //this must always be odd
const Max = 6
range Pos = Min..Max
const MaxError	= 6
range ErrorLimit	= 1..MaxError

//Concrete
MAZE = M[1][1], 
M[r:Pos][c:Pos] = ( 
				when(r < Max) s->M[r+1][c]
				| when(c > Min) w->M[r][c-1]
				| when(c < Max) e->M[r][c+1]
				| when((r == Max) * (c == Max)) {drop,load}->M[r][c]
				| when(r > Min) n->M[r-1][c]
				| when((r == Min) * (c == Min)) unload->M[r][c]
).

ARM = ({n,s,e,w}->ARM | drop ->KEEP_TRYING | load->JUST_LOADED),
KEEP_TRYING = (drop->KEEP_TRYING | load ->JUST_LOADED),
JUST_LOADED = ({n,s,e,w}->LOADED),
LOADED = ({n,s,e,w}->LOADED | unload->JUST_UNLOADED),
JUST_UNLOADED = ({n,s,e,w}->ARM).

LOCALIZER = L_B[1],
L[e:ErrorLimit]	= (when(e < MaxError) {n,s,w,e,drop,load,unload} -> L_B[e+1]
		| when(e == MaxError) {n,s,w,e,drop,load,unload} -> L_error),
L_B[e:ErrorLimit]	= (bCast -> L[e] | correct -> L[1]),
L_error	= ({n,s,w,e,drop,load,unload} -> L_error).

||C = (MAZE ||_c ARM).

|f|PLANT = (MAZE || ARM || LOCALIZER).

fluent F_Load = <load, {unload,n,s,e,w,drop,correct,bCast}>
fluent F_Unload = <unload, {load,n,s,e,w,drop,correct,bCast}>
fluent F_Dont_Drop = <load, drop> initially 1
fluent F_Broadcast = <bCast,{unload,load,n,s,e,w,stall,correct}> initially 1
|gr1| <{F_Dont_Drop}><{F_Load, F_Unload, F_Broadcast}> STRAT = PLANT.


STRAT_P =  S_0,
S_0 = (bCast-> S_1),
S_1 = (s-> S_3|e-> S_4),
S_3 = (bCast-> S_902),
S_4 = (bCast-> S_5),
S_5 = (s-> S_848|w-> S_900|e-> S_895),
S_141 = (s-> S_148|w-> S_153|e-> S_144|n-> S_145),
S_142 = (s-> S_153|w-> S_156|e-> S_145),
S_143 = (s-> S_144|w-> S_145),
S_144 = (s-> S_146|w-> S_141|n-> S_143),
S_145 = (s-> S_141|w-> S_142|e-> S_143),
S_146 = (s-> S_147|w-> S_148|n-> S_144),
S_147 = (s-> S_172|w-> S_149|n-> S_146),
S_148 = (s-> S_149|w-> S_150|e-> S_146|n-> S_141),
S_149 = (s-> S_170|w-> S_151|e-> S_147|n-> S_148),
S_150 = (s-> S_151|w-> S_152|e-> S_148|n-> S_153),
S_151 = (s-> S_168|w-> S_165|e-> S_149|n-> S_150),
S_152 = (s-> S_165|w-> S_162|e-> S_150|n-> S_154),
S_153 = (s-> S_150|w-> S_154|e-> S_141|n-> S_142),
S_154 = (s-> S_152|w-> S_155|e-> S_153|n-> S_156),
S_155 = (s-> S_162|w-> S_159|e-> S_154|n-> S_157),
S_156 = (s-> S_154|w-> S_157|e-> S_142),
S_157 = (s-> S_155|w-> S_158|e-> S_156),
S_158 = (s-> S_159|e-> S_157),
S_159 = (s-> S_160|e-> S_155|n-> S_158),
S_160 = (s-> S_161|e-> S_162|n-> S_159),
S_161 = (s-> S_215|e-> S_163|n-> S_160),
S_162 = (s-> S_163|w-> S_160|e-> S_152|n-> S_155),
S_163 = (s-> S_164|w-> S_161|e-> S_165|n-> S_162),
S_164 = (s-> S_213|w-> S_215|e-> S_166|n-> S_163),
S_165 = (s-> S_166|w-> S_163|e-> S_151|n-> S_152),
S_166 = (s-> S_167|w-> S_164|e-> S_168|n-> S_165),
S_167 = (w-> S_213|e-> S_169|n-> S_166),
S_168 = (s-> S_169|w-> S_166|e-> S_170|n-> S_151),
S_169 = (w-> S_167|e-> S_171|n-> S_168),
S_170 = (s-> S_171|w-> S_168|e-> S_172|n-> S_149),
S_171 = (w-> S_169|e-> S_173|n-> S_170),
S_172 = (s-> S_173|w-> S_170|n-> S_147),
S_173 = (load-> S_175),
S_175 = (w-> S_176|n-> S_177),
S_176 = (w-> S_206|e-> S_178|n-> S_179),
S_177 = (s-> S_178|w-> S_179|n-> S_180),
S_178 = (w-> S_176|n-> S_177),
S_179 = (s-> S_176|w-> S_205|e-> S_177|n-> S_181),
S_180 = (s-> S_177|w-> S_181|n-> S_182),
S_181 = (s-> S_179|w-> S_204|e-> S_180|n-> S_183),
S_182 = (s-> S_180|w-> S_183|n-> S_184),
S_183 = (s-> S_181|w-> S_203|e-> S_182|n-> S_185),
S_184 = (s-> S_182|w-> S_185|n-> S_186),
S_185 = (s-> S_183|w-> S_189|e-> S_184|n-> S_187),
S_186 = (s-> S_184|w-> S_187),
S_187 = (s-> S_185|w-> S_188|e-> S_186),
S_188 = (s-> S_189|w-> S_190|e-> S_187),
S_189 = (s-> S_203|w-> S_191|e-> S_185|n-> S_188),
S_190 = (s-> S_191|w-> S_192|e-> S_188),
S_191 = (s-> S_201|w-> S_193|e-> S_189|n-> S_190),
S_192 = (s-> S_193|w-> S_194|e-> S_190),
S_193 = (s-> S_199|w-> S_195|e-> S_191|n-> S_192),
S_194 = (unload-> S_196),
S_195 = (s-> S_197|e-> S_193|n-> S_194),
S_196 = (s-> S_159|e-> S_157),
S_197 = (s-> S_198|e-> S_199|n-> S_195),
S_198 = (s-> S_211|e-> S_200|n-> S_197),
S_199 = (s-> S_200|w-> S_197|e-> S_201|n-> S_193),
S_200 = (s-> S_209|w-> S_198|e-> S_202|n-> S_199),
S_201 = (s-> S_202|w-> S_199|e-> S_203|n-> S_191),
S_202 = (s-> S_207|w-> S_200|e-> S_204|n-> S_201),
S_203 = (s-> S_204|w-> S_201|e-> S_183|n-> S_189),
S_204 = (s-> S_205|w-> S_202|e-> S_181|n-> S_203),
S_205 = (s-> S_206|w-> S_207|e-> S_179|n-> S_204),
S_206 = (w-> S_208|e-> S_176|n-> S_205),
S_207 = (s-> S_208|w-> S_209|e-> S_205|n-> S_202),
S_208 = (w-> S_210|e-> S_206|n-> S_207),
S_209 = (s-> S_210|w-> S_211|e-> S_207|n-> S_200),
S_210 = (w-> S_212|e-> S_208|n-> S_209),
S_211 = (s-> S_212|e-> S_209|n-> S_198),
S_212 = (e-> S_210|n-> S_211),
S_213 = (w-> S_214|e-> S_167|n-> S_164),
S_214 = (e-> S_213|n-> S_215),
S_215 = (s-> S_214|e-> S_164|n-> S_161),
S_567 = (bCast-> S_570),
S_568 = (bCast-> S_569),
S_569 = (s-> S_155|w-> S_158|e-> S_156),
S_570 = (s-> S_160|e-> S_155|n-> S_158),
S_578 = (bCast-> S_593),
S_579 = (bCast-> S_580),
S_580 = (s-> S_581|w-> S_582|e-> S_583),
S_581 = (bCast-> S_590),
S_582 = (bCast-> S_589),
S_583 = (bCast-> S_584),
S_584 = (s-> S_585|w-> S_568|e-> S_586),
S_585 = (bCast-> S_588),
S_586 = (bCast-> S_587),
S_587 = (s-> S_153|w-> S_156|e-> S_145),
S_588 = (s-> S_152|w-> S_155|e-> S_153|n-> S_156),
S_589 = (s-> S_567|e-> S_568),
S_590 = (s-> S_591|w-> S_567|e-> S_585|n-> S_568),
S_591 = (bCast-> S_592),
S_592 = (s-> S_163|w-> S_160|e-> S_152|n-> S_155),
S_593 = (s-> S_594|e-> S_581|n-> S_582),
S_594 = (bCast-> S_595),
S_595 = (s-> S_596|e-> S_591|n-> S_567),
S_596 = (bCast-> S_597),
S_597 = (s-> S_215|e-> S_163|n-> S_160),
S_717 = (bCast-> S_720),
S_718 = (bCast-> S_719),
S_719 = (s-> S_144|w-> S_145),
S_720 = (s-> S_148|w-> S_153|e-> S_144|n-> S_145),
S_725 = (bCast-> S_726),
S_726 = (s-> S_151|w-> S_152|e-> S_148|n-> S_153),
S_736 = (bCast-> S_737),
S_737 = (s-> S_166|w-> S_163|e-> S_151|n-> S_152),
S_754 = (bCast-> S_755),
S_755 = (s-> S_213|w-> S_215|e-> S_166|n-> S_163),
S_767 = (bCast-> S_768),
S_768 = (e-> S_213|n-> S_215),
S_801 = (bCast-> S_804),
S_802 = (bCast-> S_803),
S_803 = (s-> S_725|w-> S_585|e-> S_717|n-> S_586),
S_804 = (s-> S_736|w-> S_591|e-> S_725|n-> S_585),
S_806 = (bCast-> S_807),
S_807 = (s-> S_754|w-> S_596|e-> S_736|n-> S_591),
S_811 = (bCast-> S_812),
S_812 = (s-> S_767|e-> S_754|n-> S_596),
S_834 = (bCast-> S_837),
S_835 = (bCast-> S_836),
S_836 = (s-> S_806|w-> S_594|e-> S_801|n-> S_581),
S_837 = (s-> S_811|e-> S_806|n-> S_594),
S_842 = (bCast-> S_843),
S_843 = (s-> S_834|e-> S_835|n-> S_578),
S_848 = (bCast-> S_849),
S_849 = (s-> S_835|w-> S_578|e-> S_850|n-> S_579),
S_850 = (bCast-> S_851),
S_851 = (s-> S_801|w-> S_581|e-> S_802|n-> S_583),
S_865 = (bCast-> S_866),
S_866 = (s-> S_802|w-> S_583|e-> S_867),
S_867 = (bCast-> S_868),
S_868 = (s-> S_717|w-> S_586|e-> S_718),
S_895 = (bCast-> S_896),
S_896 = (s-> S_850|w-> S_579|e-> S_865),
S_900 = (bCast-> S_901),
S_901 = (s-> S_578|e-> S_579),
S_902 = (s-> S_842|e-> S_848|n-> S_900).

// tests
equals FATAL_ROBOT_UNREALIZABLE(STRAT, STRAT_P).
