const N = 2
const K = 2

const Philosophers = N
const Steps = K

range R_Phil = 0..Philosophers-1
range R_Steps = 1..Steps

set Global_Alphabet = {think[r:R_Phil], step[r:R_Phil], take[r:R_Phil][c:R_Phil], release[r:R_Phil][c:R_Phil],eat[r:R_Phil],eat_all}
set Controllable_Alphabet = {take[r:R_Phil][c:R_Phil]}

/*****************************************************************************/

Philosopher[id:R_Phil] = Idle,
  Idle = (think[id] -> Hungry),
  Hungry = (take[id][id] -> Etiquete[Steps]),
  Etiquete[s:R_Steps] = (step[id] -> Etiquete[s-1]),
  Etiquete[0] =  (take[id][(id+1)% Philosophers] -> eat[id] -> release[id][id] -> release[id][(id+1)% Philosophers] -> Idle).

Fork[id:R_Phil] = OnTable,
  OnTable = (take[(id+1)% Philosophers][id]     -> OnHand  |  take[id][id]    -> OnHand  ),
  OnHand  = (release[(id+1)% Philosophers][id]  -> OnTable |  release[id][id] -> OnTable ).

Monitor[id:R_Phil] = (eat[id] -> Done),
  Done = (eat[id] -> Done | eat_all -> Monitor_0).
Monitor_Remove[id:R_Phil] = (eat[id] -> Done),
  Done = (eat[id] -> Done).

//*****************************************************************************

||Plant = (Philosopher[p:R_Phil] || Fork[f:R_Phil] || Monitor[m:R_Phil]).

||Plant_remove = (Philosopher[p:R_Phil] || Fork[f:R_Phil] || Monitor_Remove[m:R_Phil]).
//*****************************************************************************	

fluent F_Ass = <eat_all, eat[r:R_Phil]> initially 1
fluent F_GOAL = <eat_all, eat[r:R_Phil]>

|F| ENV = (Plant).
|F| REMOVE_ENV = (Plant_remove).

Philosopher_0 >> "/tmp/DP_2_2_ph_0.rep".
Fork_0 >> "/tmp/DP_2_2_f_0.rep".

Plant_1 >> "/tmp/DP_2_2_plant_1.rep".
Plant_0 >> "/tmp/DP_2_2_plant_0.rep".

|gr1| <{F_Ass}><{F_GOAL}>  STRAT = ENV.
|gr1| <{}><{F_GOAL}>  NO_STRAT = ENV.
|gr1| <{F_Ass}><{F_GOAL}>  REMOVE_NO_STRAT = REMOVE_ENV.

ENV >> "/tmp/dp_2_2_env.rep".
STRAT >> "/tmp/dp_2_2_strat.rep".
NO_STRAT >> "/tmp/dp_2_2_no_strat.rep".
REMOVE_NO_STRAT >> "/tmp/dp_2_2_remove_no_strat.rep".

STRAT_P= S_0,
S_0 = (think_0-> S_1|think_1-> S_2),
S_1 = (think_1-> S_3),
S_2 = (think_0-> S_3),
S_3 = (take_0_0-> S_4),
S_4 = (step_0-> S_6),
S_6 = (step_0-> S_8),
S_8 = (take_0_1-> S_10),
S_10 = (eat_0-> S_12),
S_12 = (release_0_0-> S_14),
S_14 = (release_0_1-> S_16),
S_16 = (think_0-> S_18),
S_18 = (take_1_1-> S_20),
S_20 = (step_1-> S_38),
S_38 = (step_1-> S_39),
S_39 = (take_1_0-> S_40),
S_40 = (eat_1-> S_41),
S_41 = (eat_all-> S_42|release_1_1-> S_43),
S_42 = (release_1_1-> S_44),
S_43 = (eat_all-> S_44|release_1_0-> S_45),
S_44 = (release_1_0-> S_46),
S_45 = (eat_all-> S_46|think_1-> S_47),
S_46 = (think_1-> S_48),
S_47 = (eat_all-> S_48),
S_48 = (take_0_0-> S_170),
S_130 = (eat_0-> S_131),
S_131 = (release_0_0-> S_132),
S_132 = (release_0_1-> S_133),
S_133 = (think_0-> S_134),
S_134 = (take_0_0-> S_136),
S_136 = (step_0-> S_139),
S_139 = (step_0-> S_141),
S_141 = (take_0_1-> S_143),
S_143 = (eat_0-> S_131),
S_162 = (take_0_1-> S_130),
S_166 = (step_0-> S_162),
S_170 = (step_0-> S_166).

REMOVE_NO_STRAT_P = S_0,
S_0 = (think_0-> S_2),
S_2 = (think_1-> S_3),
S_3 = (take_1_1-> S_91|take_0_0-> S_5),
S_5 = (step_0-> S_7),
S_7 = (step_0-> S_9),
S_9 = (take_1_1-> S_82|take_0_1-> S_11),
S_11 = (eat_0-> S_13),
S_13 = (release_0_0-> S_15),
S_15 = (release_0_1-> S_17),
S_17 = (think_0-> S_19),
S_19 = (take_1_1-> S_37|take_0_0-> S_21),
S_21 = (step_0-> S_23),
S_23 = (step_0-> S_25),
S_25 = (take_1_1-> S_28|take_0_1-> S_27),
S_27 = (eat_0-> S_13),
S_28 = (step_1-> S_29),
S_29 = (step_1-> S_30),
S_33 = (step_0-> S_30),
S_36 = (step_0-> S_33),
S_37 = (step_1-> S_38),
S_38 = (step_1-> S_39),
S_39 = (take_1_0-> S_40|take_0_0-> S_36),
S_40 = (eat_1-> S_41),
S_41 = (release_1_1-> S_42),
S_42 = (release_1_0-> S_43),
S_43 = (think_1-> S_44),
S_44 = (take_1_1-> S_61|take_0_0-> S_46),
S_46 = (step_0-> S_48),
S_48 = (step_0-> S_50),
S_50 = (take_1_1-> S_67|take_0_1-> S_52),
S_52 = (eat_0-> S_54),
S_54 = (release_0_0-> S_56),
S_56 = (release_0_1-> S_58),
S_58 = (think_0-> S_44),
S_61 = (step_1-> S_62),
S_62 = (step_1-> S_72),
S_67 = (step_1-> S_68),
S_68 = (step_1-> S_69),
S_70 = (step_0-> S_69),
S_71 = (step_0-> S_70),
S_72 = (take_1_0-> S_73|take_0_0-> S_71),
S_73 = (eat_1-> S_41),
S_82 = (step_1-> S_83),
S_83 = (step_1-> S_84),
S_87 = (step_0-> S_84),
S_90 = (step_0-> S_87),
S_91 = (step_1-> S_92),
S_92 = (step_1-> S_93),
S_93 = (take_1_0-> S_94|take_0_0-> S_90),
S_94 = (eat_1-> S_95),
S_95 = (release_1_1-> S_96),
S_96 = (release_1_0-> S_97),
S_97 = (think_1-> S_98),
S_98 = (take_1_1-> S_116|take_0_0-> S_100),
S_100 = (step_0-> S_102),
S_102 = (step_0-> S_104),
S_104 = (take_1_1-> S_107|take_0_1-> S_106),
S_106 = (eat_0-> S_54),
S_107 = (step_1-> S_108),
S_108 = (step_1-> S_109),
S_112 = (step_0-> S_109),
S_115 = (step_0-> S_112),
S_116 = (step_1-> S_117),
S_117 = (step_1-> S_118),
S_118 = (take_1_0-> S_119|take_0_0-> S_115),
S_119 = (eat_1-> S_95).

NO_STRAT_P = S_0,
S_0 = (think_0-> S_2),
S_2 = (think_1-> S_3),
S_3 = (take_1_1-> S_231|take_0_0-> S_5),
S_5 = (step_0-> S_7),
S_7 = (step_0-> S_9),
S_9 = (take_1_1-> S_222|take_0_1-> S_11),
S_11 = (eat_0-> S_13),
S_13 = (release_0_0-> S_15),
S_15 = (release_0_1-> S_17),
S_17 = (think_0-> S_19),
S_19 = (take_1_1-> S_37|take_0_0-> S_21),
S_21 = (step_0-> S_23),
S_23 = (step_0-> S_25),
S_25 = (take_1_1-> S_28|take_0_1-> S_27),
S_27 = (eat_0-> S_13),
S_28 = (step_1-> S_29),
S_29 = (step_1-> S_30),
S_33 = (step_0-> S_30),
S_36 = (step_0-> S_33),
S_37 = (step_1-> S_38),
S_38 = (step_1-> S_39),
S_39 = (take_1_0-> S_40|take_0_0-> S_36),
S_40 = (eat_1-> S_41),
S_41 = (eat_all-> S_42),
S_42 = (release_1_1-> S_44),
S_44 = (release_1_0-> S_46),
S_46 = (think_1-> S_171),
S_62 = (release_0_0-> S_65),
S_65 = (release_0_1-> S_68),
S_68 = (eat_all-> S_69),
S_69 = (think_0-> S_171),
S_74 = (step_1-> S_94),
S_83 = (step_1-> S_85),
S_85 = (step_1-> S_87),
S_90 = (step_0-> S_87),
S_93 = (step_0-> S_90),
S_94 = (step_1-> S_96),
S_96 = (take_1_0-> S_98|take_0_0-> S_93),
S_98 = (eat_1-> S_99),
S_99 = (release_1_1-> S_100),
S_100 = (release_1_0-> S_101),
S_101 = (think_1-> S_102),
S_102 = (take_1_1-> S_189|take_0_0-> S_104),
S_104 = (step_0-> S_106),
S_106 = (step_0-> S_108),
S_108 = (take_1_1-> S_195|take_0_1-> S_110),
S_110 = (eat_0-> S_112),
S_112 = (release_0_0-> S_114),
S_114 = (release_0_1-> S_116),
S_116 = (think_0-> S_118),
S_117 = (think_1-> S_118),
S_118 = (eat_all-> S_171),
S_127 = (eat_0-> S_128),
S_128 = (release_0_0-> S_129),
S_129 = (release_0_1-> S_130),
S_130 = (think_0-> S_132),
S_132 = (take_1_1-> S_133|take_0_0-> S_134),
S_133 = (step_1-> S_147),
S_134 = (step_0-> S_136),
S_136 = (step_0-> S_138),
S_138 = (take_1_1-> S_139|take_0_1-> S_140),
S_139 = (step_1-> S_141),
S_140 = (eat_0-> S_128),
S_141 = (step_1-> S_142),
S_144 = (step_0-> S_142),
S_146 = (step_0-> S_144),
S_147 = (step_1-> S_148),
S_148 = (take_1_0-> S_149|take_0_0-> S_146),
S_149 = (eat_1-> S_150),
S_150 = (release_1_1-> S_151),
S_151 = (release_1_0-> S_117),
S_159 = (take_1_1-> S_83|take_0_1-> S_127),
S_163 = (step_0-> S_159),
S_167 = (step_0-> S_163),
S_171 = (take_1_1-> S_74|take_0_0-> S_167),
S_189 = (step_1-> S_190),
S_190 = (step_1-> S_200),
S_195 = (step_1-> S_196),
S_196 = (step_1-> S_197),
S_198 = (step_0-> S_197),
S_199 = (step_0-> S_198),
S_200 = (take_1_0-> S_201|take_0_0-> S_199),
S_201 = (eat_1-> S_99),
S_222 = (step_1-> S_223),
S_223 = (step_1-> S_224),
S_227 = (step_0-> S_224),
S_230 = (step_0-> S_227),
S_231 = (step_1-> S_232),
S_232 = (step_1-> S_233),
S_233 = (take_1_0-> S_234|take_0_0-> S_230),
S_234 = (eat_1-> S_235),
S_235 = (release_1_1-> S_236),
S_236 = (release_1_0-> S_237),
S_237 = (think_1-> S_238),
S_238 = (take_1_1-> S_256|take_0_0-> S_240),
S_240 = (step_0-> S_242),
S_242 = (step_0-> S_244),
S_244 = (take_1_1-> S_247|take_0_1-> S_246),
S_246 = (eat_0-> S_62),
S_247 = (step_1-> S_248),
S_248 = (step_1-> S_249),
S_252 = (step_0-> S_249),
S_255 = (step_0-> S_252),
S_256 = (step_1-> S_257),
S_257 = (step_1-> S_258),
S_258 = (take_1_0-> S_259|take_0_0-> S_255),
S_259 = (eat_1-> S_235).

ENV_P= S_0,
S_0 = (think_0-> S_2|think_1-> S_1),
S_1 = (think_0-> S_3),
S_2 = (think_1-> S_3),
S_3 = (take_1_1-> S_231|take_0_0-> S_5),
S_5 = (step_0-> S_7),
S_7 = (step_0-> S_9),
S_9 = (take_1_1-> S_222|take_0_1-> S_11),
S_11 = (eat_0-> S_13),
S_13 = (release_0_0-> S_15),
S_15 = (release_0_1-> S_17),
S_17 = (think_0-> S_19),
S_19 = (take_1_1-> S_37|take_0_0-> S_21),
S_21 = (step_0-> S_23),
S_23 = (step_0-> S_25),
S_25 = (take_1_1-> S_28|take_0_1-> S_27),
S_27 = (eat_0-> S_13),
S_28 = (step_1-> S_29),
S_29 = (step_1-> S_30),
S_33 = (step_0-> S_30),
S_36 = (step_0-> S_33),
S_37 = (step_1-> S_38),
S_38 = (step_1-> S_39),
S_39 = (take_1_0-> S_40|take_0_0-> S_36),
S_40 = (eat_1-> S_41),
S_41 = (eat_all-> S_42|release_1_1-> S_43),
S_42 = (release_1_1-> S_44),
S_43 = (eat_all-> S_44|release_1_0-> S_45),
S_44 = (release_1_0-> S_46),
S_45 = (eat_all-> S_46|think_1-> S_47),
S_46 = (think_1-> S_171),
S_47 = (eat_all-> S_171),
S_62 = (eat_all-> S_205|release_0_0-> S_65),
S_65 = (eat_all-> S_204|release_0_1-> S_68),
S_68 = (eat_all-> S_69|think_0-> S_47),
S_69 = (think_0-> S_171),
S_74 = (step_1-> S_94),
S_83 = (step_1-> S_85),
S_85 = (step_1-> S_87),
S_90 = (step_0-> S_87),
S_93 = (step_0-> S_90),
S_94 = (step_1-> S_96),
S_96 = (take_1_0-> S_98|take_0_0-> S_93),
S_98 = (eat_1-> S_99),
S_99 = (release_1_1-> S_100),
S_100 = (release_1_0-> S_101),
S_101 = (think_1-> S_102),
S_102 = (take_1_1-> S_189|take_0_0-> S_104),
S_104 = (step_0-> S_106),
S_106 = (step_0-> S_108),
S_108 = (take_1_1-> S_195|take_0_1-> S_110),
S_110 = (eat_0-> S_112),
S_112 = (eat_all-> S_205|release_0_0-> S_114),
S_114 = (eat_all-> S_204|release_0_1-> S_116),
S_116 = (eat_all-> S_69|think_0-> S_118),
S_117 = (eat_all-> S_46|think_1-> S_118),
S_118 = (eat_all-> S_171),
S_127 = (eat_0-> S_128),
S_128 = (release_0_0-> S_129),
S_129 = (release_0_1-> S_130),
S_130 = (think_0-> S_132),
S_132 = (take_1_1-> S_133|take_0_0-> S_134),
S_133 = (step_1-> S_147),
S_134 = (step_0-> S_136),
S_136 = (step_0-> S_138),
S_138 = (take_1_1-> S_139|take_0_1-> S_140),
S_139 = (step_1-> S_141),
S_140 = (eat_0-> S_128),
S_141 = (step_1-> S_142),
S_144 = (step_0-> S_142),
S_146 = (step_0-> S_144),
S_147 = (step_1-> S_148),
S_148 = (take_1_0-> S_149|take_0_0-> S_146),
S_149 = (eat_1-> S_150),
S_150 = (eat_all-> S_42|release_1_1-> S_151),
S_151 = (eat_all-> S_44|release_1_0-> S_117),
S_159 = (take_1_1-> S_83|take_0_1-> S_127),
S_163 = (step_0-> S_159),
S_167 = (step_0-> S_163),
S_171 = (take_1_1-> S_74|take_0_0-> S_167),
S_189 = (step_1-> S_190),
S_190 = (step_1-> S_200),
S_195 = (step_1-> S_196),
S_196 = (step_1-> S_197),
S_198 = (step_0-> S_197),
S_199 = (step_0-> S_198),
S_200 = (take_1_0-> S_201|take_0_0-> S_199),
S_201 = (eat_1-> S_99),
S_204 = (release_0_1-> S_69),
S_205 = (release_0_0-> S_204),
S_222 = (step_1-> S_223),
S_223 = (step_1-> S_224),
S_227 = (step_0-> S_224),
S_230 = (step_0-> S_227),
S_231 = (step_1-> S_232),
S_232 = (step_1-> S_233),
S_233 = (take_1_0-> S_234|take_0_0-> S_230),
S_234 = (eat_1-> S_235),
S_235 = (release_1_1-> S_236),
S_236 = (release_1_0-> S_237),
S_237 = (think_1-> S_238),
S_238 = (take_1_1-> S_256|take_0_0-> S_240),
S_240 = (step_0-> S_242),
S_242 = (step_0-> S_244),
S_244 = (take_1_1-> S_247|take_0_1-> S_246),
S_246 = (eat_0-> S_62),
S_247 = (step_1-> S_248),
S_248 = (step_1-> S_249),
S_252 = (step_0-> S_249),
S_255 = (step_0-> S_252),
S_256 = (step_1-> S_257),
S_257 = (step_1-> S_258),
S_258 = (take_1_0-> S_259|take_0_0-> S_255),
S_259 = (eat_1-> S_235).

STRAT >> "/tmp/dp_2_2_strat.rep".

equals FATAL_DP_TEST_ENV(ENV, ENV_P).
equals FATAL_DP_TEST_STRAT(STRAT, STRAT_P).
equals FATAL_DP_TEST_NO_STRAT(NO_STRAT, NO_STRAT_P).
equals FATAL_DP_TEST_REMOVE_NO_STRAT(REMOVE_NO_STRAT, REMOVE_NO_STRAT_P).
