//GenBuf example taken from Synthesis of Reactive(1) Designs 2 senders
set Global_Alphabet = {n,s,e,w,load,unload,stall,releaseNorth, releaseSouth,correct,broadcastPosition}
set Controllable_Alphabet = {n,s,e,w,load,unload,correct,broadcastPosition}

set Global_Signals	= {Dummy}
order 				= {}
//set Moves = {n,s,e,w}
//set Actions = {load,unload}
//set A = {Moves,Actions}
const Min = 1 //this must always be odd
const Max = 3
range Pos = Min..Max
const MaxError	= 6
range ErrorLimit	= 1..MaxError

//Concrete
MAZE = M[1][1], 
M[r:Pos][c:Pos] = ( 
				when(r > Min) n->n->n->n->n->n->n->n->n->n->M[r-1][c] 
				| when(r < Max) s->s-> s->s-> s->s-> s->s-> s->s->M[r+1][c]
				| when(c > Min) w->w->M[r][c-1]
				| when(c < Max) e->e->M[r][c+1]
				| when((r == Max) * (c == Max)) load->M[r][c]
				| when((r == Min) * (c == Min)) unload->M[r][c]
				| when((r == ((Max - Min)/2))) stall -> M[r][c]
				| when((r > Min) * (r == ((Max - Min)/2))) <n, releaseNorth>->n->n->n->n->n->n->n->n->n->M[r-1][c] 
				| when((r < Max) * (r == ((Max - Min)/2))) <s, releaseSouth>->s->s->s->s->s->s->s->s->s->M[r+1][c]		
).

ARM = (load->unload->ARM).

LOCALIZER = L[1],
L[e:ErrorLimit]	= (when(e < MaxError) {n,s,e,w} -> L[e+1]
		| when(e == MaxError) {n,s,e,w} -> L_error
		| correct -> L[1]
		| broadcastPosition -> L[e]),
L_error	= ({n,s,e,w} -> L_error).

||C = (MAZE ||_c ARM).

|f|PLANT = (MAZE || ARM || LOCALIZER).

fluent F_Load = <load, {unload,n,s,e,w,stall,releaseNorth, releaseSouth,correct,broadcastPosition}>
fluent F_Unload = <unload, {load,n,s,e,w,stall,releaseNorth, releaseSouth,correct,broadcastPosition}>
fluent F_ReleaseNorth = <releaseNorth,{unload,load,n,s,e,w,stall,releaseSouth,correct,broadcastPosition}> initially 1
fluent F_ReleaseSouth = <releaseSouth,{unload,load,n,s,e,w,stall,releaseNorth,correct,broadcastPosition}> initially 1
fluent F_Broadcast = <broadcastPosition,{unload,load,n,s,e,w,stall,releaseSouth,releaseNorth,correct}>
ltl fluent A_True = (dummy || !dummy).

|gr1| <{A_True}><{F_Load, F_Unload,F_Broadcast}> STRAT = PLANT.

LOCALIZER >> "/tmp/exploration_robot_6_localizer.rep".
MAZE >> "/tmp/exploration_robot_6_maze.rep".
PLANT >> "/tmp/exploration_robot_6_plant.rep".
STRAT >> "/tmp/exploration_robot_6_strat.rep".
